// Lazy loading img & background images using intersection observer
// Reference: https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/
// Using example: <img class="lazy" src="thumb.gif" data-src="real-img.jpg" data-srcset="real-img@1x.jpg 1x, real-img@2x.jpg 2x">
// Background image class usign example: <div class="lazy-background"> with added class ".visible" for styling
// Background image style attribute lazy loading example: <div data-bg="image.jpg">

// delete window.IntersectionObserver; // Fallback Testing

document.addEventListener('DOMContentLoaded', function() {

	var lazyImages = [].slice.call(document.querySelectorAll('img.lazy'));
	var lazyBackgrounds = [].slice.call(document.querySelectorAll('.lazy-background'));
	var lazyBackgroundsData = [].slice.call(document.querySelectorAll('[data-bg]'));

	if ('IntersectionObserver' in window) {

		let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					let lazyImage = entry.target;
					lazyImage.src = lazyImage.dataset.src;
					lazyImage.srcset = lazyImage.dataset.srcset;
					lazyImage.classList.remove('lazy');
					lazyImageObserver.unobserve(lazyImage);
				}
			});
		});
		lazyImages.forEach(function(lazyImage) {
			lazyImageObserver.observe(lazyImage);
			lazyImage.onload = function(){
				this.parentElement.classList.add('visible'); //for transition effect
				this.classList.add('loaded'); //for transition effect
			}
		});

		let lazyBackgroundObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					entry.target.classList.add('visible');
					lazyBackgroundObserver.unobserve(entry.target);
				}
			});
		});
		lazyBackgrounds.forEach(function(lazyBackground) {
			lazyBackgroundObserver.observe(lazyBackground);
		});

		let lazyBackgroundDataObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					let lazyBackgroundData = entry.target;
					lazyBackgroundData.style.backgroundImage = 'url(' + lazyBackgroundData.dataset.bg + ')';
					lazyBackgroundDataObserver.unobserve(lazyBackgroundData);
				}
			});
		});
		lazyBackgroundsData.forEach(function(lazyBackgroundData) {
			lazyBackgroundDataObserver.observe(lazyBackgroundData);
		});

	} else {

		// Fallback
/*
		lazyImages.forEach(function(lazyImage) {
			lazyImage.src = lazyImage.dataset.src;
			lazyImage.srcset = lazyImage.dataset.srcset;
		});
		lazyBackgrounds.forEach(function(lazyBackground) {
			lazyBackground.classList.add('visible');
		});
		lazyBackgroundsData.forEach(function(lazyBackgroundData) {
			lazyBackgroundData.style.backgroundImage = 'url(' + lazyBackgroundData.dataset.bg + ')';
		});

*/	}

});

// Lazy loading img & background images using intersection observer
// Reference: https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/
// Using example: <img class="lazy" src="thumb.gif" data-src="real-img.jpg" data-srcset="real-img@1x.jpg 1x, real-img@2x.jpg 2x">
// Background image class usign example: <div class="lazy-background"> with added class ".visible" for styling
// Background image style attribute lazy loading example: <div data-bg="image.jpg">

// delete window.IntersectionObserver; // Fallback Testing

document.addEventListener('DOMContentLoaded', function() {

	var lazyImages = [].slice.call(document.querySelectorAll('img.lazy'));
	var lazyBackgrounds = [].slice.call(document.querySelectorAll('.lazy-background'));
	var lazyBackgroundsData = [].slice.call(document.querySelectorAll('[data-bg]'));

	if ('IntersectionObserver' in window) {

		let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					let lazyImage = entry.target;
					lazyImage.src = lazyImage.dataset.src;
					lazyImage.srcset = lazyImage.dataset.srcset;
					lazyImage.classList.remove('lazy');
					lazyImageObserver.unobserve(lazyImage);
				}
			});
		});
		lazyImages.forEach(function(lazyImage) {
			lazyImageObserver.observe(lazyImage);
			lazyImage.onload = function(){
				this.parentElement.classList.add('visible'); //for transition effect
				this.classList.add('loaded'); //for transition effect
			}
		});

		let lazyBackgroundObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					entry.target.classList.add('visible');
					lazyBackgroundObserver.unobserve(entry.target);
				}
			});
		});
		lazyBackgrounds.forEach(function(lazyBackground) {
			lazyBackgroundObserver.observe(lazyBackground);
		});

		let lazyBackgroundDataObserver = new IntersectionObserver(function(entries, observer) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					let lazyBackgroundData = entry.target;
					lazyBackgroundData.style.backgroundImage = 'url(' + lazyBackgroundData.dataset.bg + ')';
					lazyBackgroundDataObserver.unobserve(lazyBackgroundData);
				}
			});
		});
		lazyBackgroundsData.forEach(function(lazyBackgroundData) {
			lazyBackgroundDataObserver.observe(lazyBackgroundData);
		});

	} else {

		// Fallback
/*
		lazyImages.forEach(function(lazyImage) {
			lazyImage.src = lazyImage.dataset.src;
			lazyImage.srcset = lazyImage.dataset.srcset;
		});
		lazyBackgrounds.forEach(function(lazyBackground) {
			lazyBackground.classList.add('visible');
		});
		lazyBackgroundsData.forEach(function(lazyBackgroundData) {
			lazyBackgroundData.style.backgroundImage = 'url(' + lazyBackgroundData.dataset.bg + ')';
		});

*/	}

});

/*
 * Including vendors JS libraries.
 * @version 1.0.5
 *
 * Example:
 * //@requires ..\..\node_modules\jquery\dist\jquery.min.js
 *
 * modernizr.js needs for using CSS-transition method in jcarousel plugin (see more: https://modernizr.com)
 * //@requires modernizr\css-transitions.min.js
 *
 * lazy.js - lazy loading inline images in HTML (see more: https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/)
 * @requires lazy\lazy.js
 *
 * Lightbox for Gallery viewing
 * //@requires ..\plugins\imageGallery\gallerylightbox.js
 * //@requires ..\plugins\imageGallery\gallerylightbox.controls.js
 *
 * Slider jCarousel including
 * //@requires ..\..\node_modules\jcarousel\dist\jquery.jcarousel.min.js
 *
 * Swipe function for jCarousel above
 * //@requires ..\..\node_modules\jcarouselSwipe\dist\jquery.jcarousel-swipe.min.js
 *
 *
 */


/*
 * Including vendors JS libraries.
 * @version 1.0.5
 *
 * Example:
 * //@requires ..\..\node_modules\jquery\dist\jquery.min.js
 *
 * modernizr.js needs for using CSS-transition method in jcarousel plugin (see more: https://modernizr.com)
 * //@requires modernizr\css-transitions.min.js
 *
 * lazy.js - lazy loading inline images in HTML (see more: https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/)
 * @requires lazy\lazy.js
 *
 * Lightbox for Gallery viewing
 * //@requires ..\plugins\imageGallery\gallerylightbox.js
 * //@requires ..\plugins\imageGallery\gallerylightbox.controls.js
 *
 * Slider jCarousel including
 * //@requires ..\..\node_modules\jcarousel\dist\jquery.jcarousel.min.js
 *
 * Swipe function for jCarousel above
 * //@requires ..\..\node_modules\jcarouselSwipe\dist\jquery.jcarousel-swipe.min.js
 *
 *
 */

